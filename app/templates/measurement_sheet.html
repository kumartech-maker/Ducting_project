<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .form-section { background: #f4f4f4; padding: 20px; border-radius: 10px; }
    .table-section { margin-top: 30px; }
    .autocad-viewer { height: 300px; background: #e9ecef; border: 1px dashed #ccc; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #888; }
    .table th, .table td { vertical-align: middle; }
  </style>
</head>
<body>
<div class="container-fluid mt-4">
  <div class="row">
    <!-- Left Side Uploads -->
    <div class="col-md-4">
      <div class="form-section">
        <h5>Upload Drawings</h5>
        <div class="mb-3">
          <label class="form-label">Source Tag Drawing</label>
          <input type="file" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Revision Upload</label>
          <input type="file" class="form-control">
        </div>
        <div class="autocad-viewer">AutoCAD Viewer</div>
      </div>
    </div>

    <!-- Right Side Form -->
    <div class="col-md-8">
      <div class="form-section">
        <h5>Measurement Entry</h5>
        <div class="row g-2">
          <div class="col-md-2"><input type="text" id="duct_no" class="form-control" placeholder="Duct No"></div>
          <div class="col-md-2">
            <select id="duct_type" class="form-select">
              <option value="">Type</option>
              <option value="st">Straight</option>
              <option value="elb">Elbow</option>
              <option value="red">Reducer</option>
              <option value="dm">Ductmate</option>
              <option value="offset">Offset</option>
              <option value="shoe">Shoe</option>
              <option value="vanes">Vanes</option>
            </select>
          </div>
          <div class="col-md-1"><input type="number" id="w1" class="form-control" placeholder="W1"></div>
          <div class="col-md-1"><input type="number" id="h1" class="form-control" placeholder="H1"></div>
          <div class="col-md-1"><input type="number" id="w2" class="form-control" placeholder="W2"></div>
          <div class="col-md-1"><input type="number" id="h2" class="form-control" placeholder="H2"></div>
          <div class="col-md-1"><input type="number" id="length" class="form-control" placeholder="Len"></div>
          <div class="col-md-1"><input type="number" id="degree" class="form-control" placeholder="Deg/Off"></div>
          <div class="col-md-1"><input type="number" id="quantity" class="form-control" placeholder="Qty"></div>
          <div class="col-md-1"><input type="number" id="factor" class="form-control" placeholder="Fact"></div>
        </div>
        <div class="mt-3">
          <button class="btn btn-primary" onclick="addEntry()">Add Entry</button>
        </div>
      </div>

      <!-- Live Table -->
      <div class="table-section">
        <h5>Live Table</h5>
        <table class="table table-bordered table-striped" id="live-table">
          <thead class="table-dark">
            <tr>
              <th>Duct No</th>
              <th>Type</th>
              <th>W1</th>
              <th>H1</th>
              <th>W2</th>
              <th>H2</th>
              <th>Length</th>
              <th>Degree</th>
              <th>Qty</th>
              <th>Factor</th>
              <th>Gauge</th>
              <th>24g</th>
              <th>22g</th>
              <th>20g</th>
              <th>18g</th>
              <th>Area</th>
              <th>Cleat</th>
              <th>Nuts & Bolts</th>
              <th>Gasket</th>
              <th>Corner</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>

      <!-- Bottom Buttons -->
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-success">Submit</button>
        <button class="btn btn-outline-primary">Export to PDF</button>
        <button class="btn btn-outline-secondary">Export to Excel</button>
        <button class="btn btn-outline-dark">Print</button>
      </div>
    </div>
  </div>
</div>

<script>
function addEntry() {
  const entry = {
    duct_no: document.getElementById("duct_no").value,
    duct_type: document.getElementById("duct_type").value,
    w1: parseFloat(document.getElementById("w1").value) || 0,
    h1: parseFloat(document.getElementById("h1").value) || 0,
    w2: parseFloat(document.getElementById("w2").value) || 0,
    h2: parseFloat(document.getElementById("h2").value) || 0,
    length: parseFloat(document.getElementById("length").value) || 0,
    degree: parseFloat(document.getElementById("degree").value) || 0,
    quantity: parseInt(document.getElementById("quantity").value) || 1,
    factor: parseFloat(document.getElementById("factor").value) || 1
  };

  fetch("/calculate_measurement", {
    method: "POST",
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(entry)
  })
  .then(res => res.json())
  .then(data => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${entry.duct_no}</td>
      <td>${entry.duct_type}</td>
      <td>${entry.w1}</td>
      <td>${entry.h1}</td>
      <td>${entry.w2}</td>
      <td>${entry.h2}</td>
      <td>${entry.length}</td>
      <td>${entry.degree}</td>
      <td>${entry.quantity}</td>
      <td>${entry.factor}</td>
      <td>${data.gauge}</td>
      <td>${data.g24}</td>
      <td>${data.g22}</td>
      <td>${data.g20}</td>
      <td>${data.g18}</td>
      <td>${data.area}</td>
      <td>${data.cleat}</td>
      <td>${data.nuts_bolts}</td>
      <td>${data.gasket}</td>
      <td>${data.corner}</td>
      <td>
        <button class="btn btn-sm btn-warning">Edit</button>
        <button class="btn btn-sm btn-danger">Delete</button>
      </td>
    `;
    document.getElementById("table-body").appendChild(row);
  })
  .catch(error => {
    alert("Calculation failed: " + error);
  });
}
</script>
</body>
</html>
